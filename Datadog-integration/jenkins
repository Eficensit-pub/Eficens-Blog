pipeline {
    agent any

    environment {
        STACK_NAME = 'YourStackName'
        TEMPLATE_FILE = 'path/to/your-template.yaml'
        AWS_REGION = 'YourAWSRegion'
        AWS_ACCESS_KEY_ID_CREDENTIALS = 'your-aws-access-key-id-credential-id'
        AWS_SECRET_ACCESS_KEY_CREDENTIALS = 'your-aws-secret-access-key-credential-id'
    }

    stages {
        stage('Checkout') {
            steps {
                // Check out the Git repository
                script {
                    git 'https://github.com/your-username/your-repo.git'
                }
            }
        }

        stage('Deploy CloudFormation') {
            steps {
                // Retrieve AWS access key ID from Jenkins credentials
                script {
                    AWS_ACCESS_KEY_ID = credentials("${AWS_ACCESS_KEY_ID_CREDENTIALS}").getUsername()
                    AWS_SECRET_ACCESS_KEY = credentials("${AWS_SECRET_ACCESS_KEY_CREDENTIALS}").getSecret()
                }

                // Deploy CloudFormation stack using AWS CloudFormation Jenkins plugin
                script {
                    cfnDeploy(
                        stack: "${STACK_NAME}",
                        template: "${TEMPLATE_FILE}",
                        region: "${AWS_REGION}",
                        capabilities: ['CAPABILITY_IAM'],
                        accessKeyId: "${AWS_ACCESS_KEY_ID}",
                        secretKey: "${AWS_SECRET_ACCESS_KEY}"
                    )
                }
            }
        }
    }

    post {
        success {
            echo 'Stack deployment successful!'
        }
        failure {
            echo 'Stack deployment failed!'
        }
    }
}
